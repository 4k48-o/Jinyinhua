# 错误码体系文档

## 📋 概述

本文档定义了项目的业务错误码体系，用于统一错误处理和错误追踪。

## 🎯 错误码格式

错误码格式：`E{模块}{类型}{序号}`

- **E**: 固定前缀，表示 Error
- **模块**: 2 位数字，表示功能模块
- **类型**: 2 位数字，表示错误类型
- **序号**: 2 位数字，表示具体错误

### 模块编码

| 模块 | 编码 | 说明 |
|------|------|------|
| 通用 | 00 | 通用错误 |
| 认证 | 01 | 认证相关错误 |
| 授权 | 02 | 权限相关错误 |
| 资源 | 03 | 资源操作错误 |
| 业务 | 04 | 业务逻辑错误 |
| 限流 | 05 | 限流相关错误 |
| 服务 | 06 | 服务可用性错误 |

### 错误类型编码

| 类型 | 编码 | 说明 |
|------|------|------|
| 参数错误 | 01 | 请求参数错误 |
| 验证错误 | 02 | 数据验证失败 |
| 认证错误 | 03 | 认证失败 |
| 权限错误 | 04 | 权限不足 |
| 资源错误 | 05 | 资源不存在或冲突 |
| 业务错误 | 06 | 业务逻辑错误 |
| 系统错误 | 07 | 系统内部错误 |

## 📝 错误码列表

### E00xxxx - 通用错误

| 错误码 | HTTP 状态码 | 说明 | 示例 |
|--------|------------|------|------|
| E000000 | 500 | 服务器内部错误 | 未处理的异常 |

### E01xxxx - 认证相关错误

| 错误码 | HTTP 状态码 | 说明 | 示例 |
|--------|------------|------|------|
| E010101 | 400 | 认证参数错误 | 缺少用户名或密码 |
| E010201 | 400 | 认证验证失败 | 用户名或密码错误 |
| E010301 | 401 | 认证失败 | Token 无效或过期 |
| E010302 | 401 | Token 过期 | Access Token 已过期 |
| E010303 | 401 | Token 无效 | Token 格式错误 |

### E02xxxx - 授权相关错误

| 错误码 | HTTP 状态码 | 说明 | 示例 |
|--------|------------|------|------|
| E020401 | 403 | 权限不足 | 无权限访问该资源 |
| E020402 | 403 | 角色权限不足 | 当前角色无此权限 |

### E03xxxx - 资源操作错误

| 错误码 | HTTP 状态码 | 说明 | 示例 |
|--------|------------|------|------|
| E030501 | 404 | 资源不存在 | 用户不存在 |
| E030502 | 404 | 资源已删除 | 资源已被软删除 |
| E030601 | 409 | 资源冲突 | 用户名已存在 |
| E030602 | 409 | 资源重复 | 邮箱已被使用 |

### E04xxxx - 业务逻辑错误

| 错误码 | HTTP 状态码 | 说明 | 示例 |
|--------|------------|------|------|
| E040601 | 400 | 业务处理失败 | 操作违反业务规则 |
| E040602 | 400 | 状态不允许 | 资源状态不允许此操作 |

### E05xxxx - 限流相关错误

| 错误码 | HTTP 状态码 | 说明 | 示例 |
|--------|------------|------|------|
| E050701 | 429 | 请求过于频繁 | 超过限流阈值 |

### E06xxxx - 服务可用性错误

| 错误码 | HTTP 状态码 | 说明 | 示例 |
|--------|------------|------|------|
| E060701 | 503 | 服务不可用 | 服务暂时不可用 |
| E060702 | 503 | 数据库连接失败 | 数据库服务不可用 |

## 🔍 错误码使用示例

### 在视图中使用

```python
from apps.common.exceptions import ValidationException, NotFoundException
from apps.common.response import APIResponse

def my_view(request):
    try:
        # 业务逻辑
        if not user:
            raise NotFoundException('用户不存在', code='E030501')
        
        if not validate_data(data):
            raise ValidationException('数据验证失败', code='E010201')
        
        return APIResponse.success(data=result, request_id=request.request_id)
    except Exception as e:
        # 异常会被中间件或异常处理器捕获
        raise
```

### 在序列化器中使用

```python
from rest_framework import serializers
from apps.common.exceptions import ValidationException

class MySerializer(serializers.Serializer):
    def validate(self, attrs):
        if not attrs.get('field'):
            raise ValidationException('字段不能为空', code='E010201')
        return attrs
```

## 📊 错误码统计

- **总错误码数**: 20+ (持续扩展)
- **已定义模块**: 7 个
- **错误类型**: 7 种

## 🔄 错误码扩展

### 添加新错误码

1. 在 `apps/common/exceptions.py` 中定义新的异常类
2. 在本文档中记录新错误码
3. 更新错误码统计

### 错误码命名规范

- 使用有意义的错误码
- 保持错误码的唯一性
- 遵循模块和类型编码规则

---

**文档版本**: v1.0  
**最后更新**: 2025-12-06

